acity_1988
plot(acity_1988)
st_crs(dis2023)
dis2023_crs <- st_crs(dis2023)
acity_1988_crs <- st_crs(acity_1988)
aarhus_mun_crs <- st_crs(aarhus_mun)
dis2023_crs
acity_1988_crs
aarhus_mun_crs
class(dis2023)
class(acity_1988)
class(aarhus_mun)
plot(st_gemoetry(dis2023))
plot(st_geometry(dis2023))
plot(st_geometry(aarhus_mun), col="blue", add=TRUE)
plot(st_geometry(acity_1988), col="red", add=TRUE)
plot(st_geometry(dis2023))
plot(st_geometry(aarhus_mun), col="blue", add=TRUE)
plot(st_geometry(dis2023))
plot(st_geometry(aarhus_mun), col="blue", add=TRUE)
plot(st_geometry(acity_1988), col="red", add=TRUE)
plot(st_geometry(dis2023))
plot(st_geometry(dis2023))
plot(st_geometry(aarhus_mun), col="blue", add=TRUE)
plot(st_geometry(acity_1988), col="red", add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue", add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue", add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue")
plot(st_geometry(dis2023), add=TRUE)
plot(st_geometry(acity_1988), col="red", add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue")
plot(st_geometry(dis2023), add=TRUE)
plot(st_geometry(acity_1988), col="red", alpha=0.5, add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue")
plot(st_geometry(dis2023), add=TRUE)
plot(st_geometry(acity_1988), col="red", alpha=0.2, add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue")
plot(st_geometry(dis2023), add=TRUE)
plot(st_geometry(acity_1988), col="red", alpha=15, add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue")
plot(st_geometry(dis2023), add=TRUE)
plot(st_geometry(acity_1988), col="red", alpha=15, add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue")
plot(dis2023, add=TRUE)
plot(st_geometry(acity_1988), col="red", alpha=15, add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue")
plot(dis2023$status, add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue")
plot(dis2023$status, add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue")
plot(dis2023$noegle, add=TRUE)
plot(st_geometry(acity_1988), col="red", alpha=15, add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue")
plot(dis2023, add=TRUE)
plot(st_geometry(acity_1988), col="red", alpha=15, add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue")
plot(dis2023, add=TRUE)
plot(st_geometry(acity_1988), col="red", alpha=15, add=TRUE)
View(dis2023)
plot(dis2023$prog_distrikt_navn)
plot(dis2023$)
plot(dis2023)
plot(dis2023["prog_dist_navn"])
plot(dis2023["prog_distrikt_navn"])
plot(st_geometry(aarhus_mun), col="lightblue")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col="red", alpha=15, add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col=adjustcolor("red", alpha.f = 0.2), add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col=adjustcolor("red", alpha.f = 0.5), add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col=adjustcolor("blue", alpha.f = 0.5), add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue", title("Hej"))
plot(st_geometry(aarhus_mun), col="lightblue", title("Hej"))
plot(st_geometry(aarhus_mun), col="lightblue")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col=adjustcolor("blue", alpha.f = 0.5), add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue", main="Hej")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col=adjustcolor("blue", alpha.f = 0.5), add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue", main="Aarhus city (1988), Distrikts 2023")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col=adjustcolor("blue", alpha.f = 0.5), add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue", main="Aarhus city (1988), Distrikts 2023")
title(sub = "Blue = 1988 city boundary")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col=adjustcolor("blue", alpha.f = 0.5), add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue", main="Aarhus city (1988), Distrikts 2023")
title(sub = "Blue = 1988 city boundary")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col=adjustcolor("blue", alpha.f = 0.5), add=TRUE)
legend(
"topright",
legend = c("Municipality", "1988 City Boundary"),
fill = c("lightblue", adjustcolor("blue", alpha.f = 0.5)),
bty = "n"
)
bb <- st_bbox(aarhus_mun)
plot(
st_geometry(aarhus_mun),
col = "lightblue",
xlim = c(bb["xmin"], bb["xmax"]),
ylim = c(bb["ymin"], bb["ymax"]),
main = "Aarhus city (1988), Distrikts 2023"
)
plot(dis2023["prog_distrikt_navn"], add = TRUE)
plot(
st_geometry(acity_1988),
col = adjustcolor("blue", alpha.f = 0.5),
add = TRUE
)
bb <- st_bbox(aarhus_mun)
zoom_factor <- 0.6  # smaller = more zoom
x_center <- mean(c(bb["xmin"], bb["xmax"]))
y_center <- mean(c(bb["ymin"], bb["ymax"]))
x_range <- diff(c(bb["xmin"], bb["xmax"])) * zoom_factor / 2
y_range <- diff(c(bb["ymin"], bb["ymax"])) * zoom_factor / 2
plot(
st_geometry(aarhus_mun),
col = "lightblue",
xlim = c(x_center - x_range, x_center + x_range),
ylim = c(y_center - y_range, y_center + y_range),
main = "Aarhus city (1988), Distrikts 2023"
)
plot(dis2023["prog_distrikt_navn"], add = TRUE)
plot(st_geometry(acity_1988),
col = adjustcolor("blue", alpha.f = 0.5),
add = TRUE)
library(geodata)
elevation <- elevation_30s(country = "DNK", mask = TRUE, path = tempdir())
library(geodata)
?gadm()
elevation <- elevation_30s(country = "DNK", mask = TRUE, path = tempdir())
municipalities <- gadm(country = "DNK", level = 2, path = ".") %>% st_as_sf()
DK_border <- gadm(country = "DNK", level = 0, path = ".")%>% st_as_sf()
?gadm()
plot(elevation)
elevation <- elevation_30s(country = "DNK", mask = FALSE, path = tempdir())
plot(elevation)
elevation <- elevation_30s(country = "DNK", mask = TRUE, path = tempdir())
plot(elevation)
plot(st_geometry(DK_border), add=TRUE)
plot(elevation)
plot(st_geometry(DK_border), add=TRUE)
plot(elevation)
plot(st_geometry(DK_border), col="red" add=TRUE)
plot(elevation)
plot(st_geometry(DK_border), col="red", add=TRUE)
plot(elevation)
plot(municipalities["NAME_2"], add=TRUE)
library(terra)
library(sf)
# elevation is a SpatRaster (from geodata)
el <- elevation
# choose breaks (meters) â€“ tweak to your needs
breaks <- c(0, 25, 50, 100, 200, 500, 1000)
# classify raster into band IDs 1..n
el_cls <- terra::classify(
el,
rcl = cbind(breaks[-length(breaks)], breaks[-1], seq_len(length(breaks) - 1))
)
el_pol <- terra::as.polygons(el_cls, dissolve = TRUE, na.rm = TRUE)
el_sf  <- st_as_sf(el_pol)
names(el_sf)[names(el_sf) == "layer"] <- "band"
# helper: draw hatched sf polygon layer
plot_hatched_sf <- function(x, density, angle, border = NA, ...) {
g <- st_geometry(x)
for (i in seq_along(g)) {
# cast to POLYGON pieces so polygon() can draw them
parts <- st_cast(g[i], "POLYGON", warn = FALSE)
for (p in seq_along(parts)) {
coords <- st_coordinates(parts[p])
# st_coordinates gives matrix with X,Y and L1/L2 indices sometimes;
# take the actual X,Y in order
polygon(coords[, "X"], coords[, "Y"],
density = density, angle = angle,
border = border, ...)
}
}
}
# map bands -> hatch styles (edit!)
dens_map  <- c(0, 10, 15, 20, 25, 30)  # 0 = no hatch
angle_map <- c(0, 45, 45, 45, 45, 45)
# plot base
plot(st_geometry(DK_border), col = NA, border = "black", main = "DK municipalities + elevation hatches")
plot(st_geometry(municipalities), add = TRUE, border = "grey40")
# overlay hatches band-by-band
for (b in sort(unique(el_sf$band))) {
sel <- el_sf[el_sf$band == b, ]
plot_hatched_sf(sel,
density = dens_map[b],
angle   = angle_map[b],
col     = NA)  # no fill, hatch only
}
plot(el, col = gray.colors(20), axes = FALSE, main = "Elevation + municipalities")
terra::contour(el, add = TRUE, levels = c(25, 50, 100, 200), col = "black")
plot(st_geometry(municipalities), add = TRUE, border = "white", lwd = 0.5)
plot(st_geometry(DK_border), add = TRUE, border = "black", lwd = 1.2)
# helper: draw hatched sf polygon layer
plot_hatched_sf <- function(x, density, angle, border = NA, ...) {
g <- st_geometry(x)
for (i in seq_along(g)) {
# cast to POLYGON pieces so polygon() can draw them
parts <- st_cast(g[i], "POLYGON", warn = FALSE)
for (p in seq_along(parts)) {
coords <- st_coordinates(parts[p])
# st_coordinates gives matrix with X,Y and L1/L2 indices sometimes;
# take the actual X,Y in order
polygon(coords[, "X"], coords[, "Y"],
density = density, angle = angle,
border = border, ...)
}
}
}
# map bands -> hatch styles (edit!)
dens_map  <- c(0, 10, 15, 20, 25, 30)  # 0 = no hatch
angle_map <- c(0, 45, 45, 45, 45, 45)
# plot base
plot(st_geometry(DK_border), col = NA, border = "black", main = "DK municipalities + elevation hatches")
plot(st_geometry(municipalities), add = TRUE, border = "grey40")
# overlay hatches band-by-band
for (b in sort(unique(el_sf$band))) {
sel <- el_sf[el_sf$band == b, ]
plot_hatched_sf(sel,
density = dens_map[b],
angle   = angle_map[b],
col     = NA)  # no fill, hatch only
}
st_crs(elevation)
crs(elevation)
crs(municipalities)
st_crs(elevation)
st_crs(municipalities)
st_crs(border)
st_crs(border)
st_crs(DK_border)
dis2023_crs <- st_crs(dis2023)
dis2023_crs <- st_crs(dis2023)
class(dis2023)
dis2023_crs
acity_1988_crs
aarhus_mun_crs
aarhus_mun_crs
acity_1988_crs
acity_1988_crs
dis2023_crs
acity_1988_crs
aarhus_mun_crs
dis2023_crs
acity_1988_crs
aarhus_mun_crs
plot(st_geometry(aarhus_mun), col="lightblue", main="Aarhus city (1988), Distrikts 2023")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col=adjustcolor("blue", alpha.f = 0.5), add=TRUE)
legend(
"topright",
legend = c("Municipality", "1988 City Boundary"),
fill = c("lightblue", adjustcolor("blue", alpha.f = 0.5)),
bty = "n"
)
plot(st_geometry(aarhus_mun), col="lightblue", main="Aarhus city (1988), Distrikts 2023")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col=adjustcolor("blue", alpha.f = 0.5), add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue", main="Aarhus city (1988), Distrikts 2023")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col=adjustcolor("blue", alpha.f = 0.5), add=TRUE)
legend(
"topright",
legend = c("Municipality", "1988 City Boundary"),
fill = c("lightblue", adjustcolor("blue", alpha.f = 0.5)),
bty = "n"
)
library(arrow)
install.packages("arrow")
#install.packages("arrow")
library(arrow)
library(sf)
tab <- arrow::read_parquet("data/mystery/districts2023.parquet")
tab <- arrow::read_parquet(a_bbr_parquet)
sfobj <- sf::st_as_sf(tab)   # works if there's a geo/geometry column in a known format
plot(sfobj)
abbr_1990 <- sf::st_as_sf(tab)   # works if there's a geo/geometry column in a known format
aarhus_mun
plot(aarhus_mun)
dis2023
plot(dis2023)
acity_1988
plot(acity_1988)
abbr_1990
plot(abbr_1990)
dis2023_crs <- st_crs(dis2023)
acity_1988_crs <- st_crs(acity_1988)
aarhus_mun_crs <- st_crs(aarhus_mun)
abbr_1990_crs <- st_crs(abbr_1990)
class(dis2023)
class(acity_1988)
class(aarhus_mun)
class(abbr_1990)
dis2023_crs
acity_1988_crs
aarhus_mun_crs
abbr_1990_crs
abbr_1990 <- st_transform(abbr_1990, crs=dis2023_crs)
dis2023_crs
abbr_1990_crs # is NA CRS!
abbr_1990 <- st_crs(abbr_1990) = 4326
st_crs(abbr_1990) = 4326
abbr_1990_crs <- st_crs(abbr_1990)
abbr_1990_crs # is NA CRS!
plot(abbr_1990)
plot(abbr_1990["est_pop"])
plot(st_geometry(aarhus_mun), col="lightblue", main="Aarhus city (1988), Distrikts 2023")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col=adjustcolor("blue", alpha.f = 0.5), add=TRUE)
plot(abbr_1990["est_pop"], add=TRUE)
legend(
"topright",
legend = c("Municipality", "1988 City Boundary"),
fill = c("lightblue", adjustcolor("blue", alpha.f = 0.5)),
bty = "n"
)
plot(st_geometry(aarhus_mun), col="lightblue", main="Aarhus city (1988), Distrikts 2023")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col=adjustcolor("blue", alpha.f = 0.5), add=TRUE)
plot(abbr_1990["est_pop"], col=adjustcolor("pink", alpha.f = 0.1), add=TRUE)
legend(
"topright",
legend = c("Municipality", "1988 City Boundary"),
fill = c("lightblue", adjustcolor("blue", alpha.f = 0.5)),
bty = "n"
)
plot(st_geometry(aarhus_mun), col="lightblue", main="Aarhus city (1988), Distrikts 2023")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col=adjustcolor("blue", alpha.f = 0.5), add=TRUE)
plot(abbr_1990["est_pop"], col=adjustcolor("pink", alpha.f = 0.1), lwd=1, add=TRUE)
legend(
"topright",
legend = c("Municipality", "1988 City Boundary"),
fill = c("lightblue", adjustcolor("blue", alpha.f = 0.5)),
bty = "n"
)
plot(st_geometry(aarhus_mun), col="lightblue", main="Aarhus city (1988), Distrikts 2023")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col=adjustcolor("blue", alpha.f = 0.5), add=TRUE)
plot(abbr_1990["est_pop"], col=adjustcolor("pink", alpha.f = 0.1), lwd=5, add=TRUE)
legend(
"topright",
legend = c("Municipality", "1988 City Boundary"),
fill = c("lightblue", adjustcolor("blue", alpha.f = 0.5)),
bty = "n"
)
plot(st_geometry(aarhus_mun), col="lightblue", main="Aarhus city (1988), Distrikts 2023")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col=adjustcolor("blue", alpha.f = 0.5), add=TRUE)
plot(abbr_1990["est_pop"], col=adjustcolor("pink", alpha.f = 0.1), pch=1, add=TRUE)
legend(
"topright",
legend = c("Municipality", "1988 City Boundary"),
fill = c("lightblue", adjustcolor("blue", alpha.f = 0.5)),
bty = "n"
)
View(abbr_1990)
plot(abbr_1990["byg054AntalEtager"])
plot(abbr_1990["byg054AntalEtager"], col=adjustcolor("pink", alpha.f = 0.1), pch=1, add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue", main="Aarhus city (1988), Distrikts 2023")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col=adjustcolor("blue", alpha.f = 0.5), add=TRUE)
plot(abbr_1990["byg054AntalEtager"], col=adjustcolor("pink", alpha.f = 0.1), pch=1, add=TRUE)
legend(
"topright",
legend = c("Municipality", "1988 City Boundary"),
fill = c("lightblue", adjustcolor("blue", alpha.f = 0.5)),
bty = "n"
)
plot(abbr_1990["byg054AntalEtager"], pch=1, add=TRUE)
plot(st_geometry(aarhus_mun), col="lightblue", main="Aarhus city (1988), Distrikts 2023")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col=adjustcolor("blue", alpha.f = 0.5), add=TRUE)
plot(abbr_1990["byg054AntalEtager"], pch=1, add=TRUE)
legend(
"topright",
legend = c("Municipality", "1988 City Boundary"),
fill = c("lightblue", adjustcolor("blue", alpha.f = 0.5)),
bty = "n"
)
st_crs(playgrounds_crs)
st_crs(elevation_crs)
st_crs(playgrounds_crs)
st_crs(abbr_1990)
dis2023_crs
st_crs(abbr_1990)
aarhus_mun_crs
abbr_1990_crs # is NA CRS!
aarhus_mun_crs
abbr_1990_crs # is NA CRS!
st_crs(abbr_1990)
plot(abbr_1990)
plot(abbr_1990["byg054AntalEtager"])
abbr_1990
abbr_1990
dis2023
acity_1988
dis2023
aarhus_mun
playgrounds
# Simply run the tmap code
install.packages("tmap")
library(tmap)
tm_shape(ortho_img) +
tm_rgb() +
tm_shape(parks) +
tm_polygons(col = "green") +
tm_shape(playgrounds_crs) +
tm_dots(col = "yellow",
size = 1)
# Simply run the tmap code
install.packages("tmap")
library(tmap)
tm_shape(ortho_img) +
tm_rgb() +
tm_shape(parks) +
tm_polygons(col = "green") +
tm_shape(playgrounds_crs) +
tm_dots(col = "yellow",
size = 1)
playgrounds
the_crs
playgrounds_32 <- st_transform(playgrounds, crs=25832)
playgrounds_32
plotRGB(ortho_img, stretch="linear")
plot(st_geometry(playgrounds_32), lwd=3, col="green", add=TRUE)
aarhus_mun
dis2023
acity_1988
abbr_1990
aarhus_mun # is latlong
dis2023 # is latlong
acity_1988 # latlong
abbr_1990 # latlong
dis2023_crs
abbr_1990
dis2023
abbr_1990
dis2023
acity_1988
aarhus_mun
st_crs(abbr_1990) = 4326
abbr_1990 <- st_transform(abbr_1990, crs=st_crs(dist2023))
abbr_1990 <- st_transform(abbr_1990, crs=st_crs(dis2023))
library(sf)
library(dplyr)
# Ensure same CRS
abbr_1990 <- st_transform(abbr_1990, st_crs(dis2023))
# Join points to districts (each point gets the district it falls in)
pts_with_dist <- st_join(
abbr_1990["byg054AntalEtager"],
dis2023["prog_distrikt_navn"],
join = st_within
)
# Summarise floors per district
dist_stats <- pts_with_dist %>%
st_drop_geometry() %>%
group_by(prog_distrikt_navn) %>%
summarise(
n_points = sum(!is.na(byg054AntalEtager)),
mean_etager = mean(byg054AntalEtager, na.rm = TRUE),
median_etager = median(byg054AntalEtager, na.rm = TRUE)
)
dis2023_hm <- dis2023 %>%
left_join(dist_stats, by = "prog_distrikt_navn")
vals <- dis2023_hm$mean_etager
# classify to bins (5 bins)
bins <- quantile(vals, probs = seq(0, 1, length.out = 6), na.rm = TRUE)
bin_id <- cut(vals, breaks = bins, include.lowest = TRUE)
cols <- colorRampPalette(c("white", "orange", "red"))(5)
plot(st_geometry(aarhus_mun), col = "lightblue",
main = "Districts colored by mean number of floors (AntalEtager)")
plot(dis2023_hm["prog_distrikt_navn"], add = TRUE, border = "grey40")  # outlines
plot(st_geometry(dis2023_hm), col = cols[bin_id], border = NA, add = TRUE)
plot(st_geometry(acity_1988), col = adjustcolor("blue", alpha.f = 0.25), add = TRUE)
legend("topright",
legend = levels(bin_id),
fill = cols,
title = "Mean floors",
bty = "n")
plot(st_geometry(aarhus_mun), col="lightblue", main="Aarhus city (1988), Distrikts 2023")
plot(dis2023["prog_distrikt_navn"], add=TRUE)
plot(st_geometry(acity_1988), col=adjustcolor("blue", alpha.f = 0.5), add=TRUE)
legend(
"topright",
legend = c("Municipality", "1988 City Boundary"),
fill = c("lightblue", adjustcolor("blue", alpha.f = 0.5)),
bty = "n"
)
aarhus_mun # is latlong
dis2023 # is latlong
acity_1988 # latlong
abbr_1990 # latlong
plot(dis2023)
plot(dis2023["prog_distrikt_navn"])
plot(dis2023["prog_distrikt_navn"])
plot(dis2023)
plot(dis2023["prog_distrikt_navn"])
plot(dis2023["prog_distrikt_nr"], add=TRUE)
plot(dis2023["prog_distrikt_nr"], add=TRUE)
plot(dis2023["prog_distrikt_navn"])
plot(dis2023["prog_distrikt_nr"])
dis2023_crs
